<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    let cities = null;
    fetch(endpoint)
      .then(function (response) {
        return response.json();
      })
      .then(function (completedData) {
        cities = completedData
        console.table(cities)
      });

    const searchInput = document.querySelector('.search');  // é¸å– input
    searchInput.addEventListener('change', displayMatches); // render ç«æŸ´æ•ˆæœ ( æŸ¥æ‰¾äº‹ä»¶ displayMatches )
    searchInput.addEventListener('keyup', displayMatches);  // render ç«æŸ´æ•ˆæœ ( æŸ¥æ‰¾äº‹ä»¶ displayMatches )

    /* ä»¥ä¸‹ æ˜¯æ¸²æŸ“ çš„å‡½å¼ , å…¶ä¸­æœ‰å¹¾æ¨£å‹•ä½œè¦åš :
       1. ç¢ºå®š æœç´¢åˆ°çš„å…§å®¹æ˜¯å¦èˆ‡ åŸå¸‚ æˆ– å· åŒ¹é…  ===>>>   findMatches()
          å‡½å¼æœƒ return æ‰€æœ‰ç¬¦åˆ åŸå¸‚ æˆ– å· è£¡å–®å­—èˆ‡ä½ è¼¸å…¥çš„è‹±æ–‡æœ‰é—œçš„ Array å›ä¾†
       2. ç„¶å¾Œ å°é‚£äº› return çš„ Array é€²è¡Œ map()
       3. map() çš„å…§å®¹æ’°å¯«è¦é» : 
          (1) ç‚ºäº†å¡˜å¡åç™½é—œéµå­—çš„ class é€²å» render å‡ºä¾†çš„ç«æŸ´å…§å®¹å¿…é ˆä½¿ç”¨ .repalce() ä¾†å°‡ input çš„å€¼å¸¶æ›æˆ <span class="">çš„å…§å®¹ã€‚
          (2) render çš„å…§å®¹é‚„æœ‰   population(äººå£) , é‚£ç‚ºäº†ä½¿å…¶é”æˆ åœ‹å¤–æ•¸å­—åªè¦ è¶…é 3 ä½æ•¸å°±è¦é€—é» "," çš„æ•ˆæœ  ex: 1,222,333 å°±åœ¨ä½¿ç”¨ä¸€æ¬¡æ­£å‰‡ ä¾† replace()    
       4. return çµ„å­—ä¸²   */
    function displayMatches() {
      const matchArray = findMatches(cities, this.value);   // findMatches å¸¶é€²( åŸå¸‚ , è¼¸å…¥æ¡†çš„ value )å…©åƒæ•¸
      console.log(matchArray)                               // é€™è£¡å¯ä»¥ console å‡ºè·Ÿä½ è¼¸å…¥çš„è‹±æ–‡å­—æœ‰åŒ¹é…çš„ åŸå¸‚ æˆ– å·
      const html = matchArray.map(place => {                // è³‡æ–™å† ä¸Š æ­£å‰‡ ä»¥å¾Œ , æŠŠè³‡æ–™é‡æ–° map 
        const regex = new RegExp(this.value, 'gi');         // é€™è£¡å†ä¸€æ¬¡å°‡ input çš„å€¼çµ¦ æ­£å‰‡åŒ–      ä¾‹å¦‚è¼¸å…¥ d  é‚£ console.log(regex) // print: /d/gi 
        const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);   // é€™è£¡å°‡ æœ‰ç¬¦åˆ regex éƒ½å–ä»£æˆ  `<span class="hl">${this.value}</span>`
        const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
        const populationNum = numberWithCommas(place.population)                               // æœ€å¾Œå†è™•ç†äººæ•¸çš„é¡¯ç¤ºè™•ç†å•é¡Œ
        return `<li>
                  <span class="name">${cityName}, ${stateName}</span>
                  <span class="population">${populationNum}</span>  
                </li> `;
      }).join('');                                          // join():æŠŠarrayObjectä¸­çš„æ‰€æœ‰å…ƒç´ æ”¾å…¥ä¸€å€‹å­—ä¸²ä¸­ã€‚

      const suggestions = document.querySelector('.suggestions');
      suggestions.innerHTML = html;
    }

    function findMatches(cities, inputValue) {
      return cities.filter(item => {
        // é€™è£¡è¦ç¢ºå®š æœç´¢åˆ°çš„å…§å®¹æ˜¯å¦èˆ‡ åŸå¸‚ æˆ– å· åŒ¹é…
        const regex = new RegExp(inputValue, 'gi');  // RegExp():ç”¨ä¾†åšæ­£è¦è¡¨é”ç¤ºçš„åƒæ•¸ï¼Œ gä»£è¡¨global,iä»£è¡¨insensitive,ä¸å—å¤§å°å¯«å½±éŸ¿
        return item.city.match(regex) || item.state.match(regex) // åªè¦ city æˆ– state å…¶ä¸­ä¸€æ¨£æœ‰åŒ¹é…åˆ°æ•‘å›å‚³
      });
    }

      // ç”¨numberWithCommasè™•ç†æ­£è¦è¡¨é”è©¦çš„å•é¡Œ
      //  "/"é–‹é ­èˆ‡çµå°¾ , "g" å…¨åŸŸ
    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','); // é€™è£¡å¯¦ç¾æ¯3ä½æ•¸å°±æœ‰ä¸€å€‹é€—é» ex: 1,222,333
    }

  </script>
</body>

</html>